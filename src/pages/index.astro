---
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import SearchBar from '../components/SearchBar.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

// Get all blog posts, sorted by date (newest first)
const allPosts = await getCollection('blog', ({ data }: CollectionEntry<'blog'>) => {
  return data.draft !== true;
});

const sortedPosts = allPosts.sort((a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) => 
  b.data.date.getTime() - a.data.date.getTime()
);
---

<BaseLayout 
  title="SENRI Dev | Performance & HCI Blog"
  description="A blog focused on web performance optimization, human-computer interaction, and modern development practices."
>
  <!-- No hero title; minimalist list only -->

  <!-- Posts Grid -->
  <section class="container mx-auto px-4 lg:px-8 py-16">
    <div class="max-w-3xl mx-auto">
      <!-- Search Bar -->
      <SearchBar posts={sortedPosts} />
      
      <!-- Posts Grid -->
      <div class="grid grid-cols-1 gap-12">
        {sortedPosts.map((post: CollectionEntry<'blog'>, index: number) => (
          <PostCard 
            title={post.data.title}
            description={post.data.description}
            date={post.data.date}
            author={post.data.author}
            authorAvatar={post.data.authorAvatar}
            slug={post.slug}
            image={post.data.image}
            number={index + 1}
            cardHoverColor={post.data.cardHoverColor}
          />
        ))}
      </div>

      {sortedPosts.length === 0 && (
        <div class="text-center py-20">
          <p class="text-gray-600 text-xl">No posts yet. Check back soon!</p>
        </div>
      )}
    </div>
  </section>
</BaseLayout>
