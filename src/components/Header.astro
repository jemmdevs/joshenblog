---
// Header component inspired by Azuki's design
interface Props {
  customNavColor?: string;        // Color personalizado para botones y texto (predeterminado: #000000)
  customNavHoverColor?: string;   // Color personalizado para hover (predeterminado: #FDFDFD)
  customLogoHoverColor?: string;  // Color personalizado para hover de SENRI y WORKS (predeterminado: usa navHoverColor)
  pageBackground?: string;        // Color de fondo de la página (usado para navbar en posts)
}

const { customNavColor, customNavHoverColor, customLogoHoverColor, pageBackground } = Astro.props;

// Usar colores personalizados o predeterminados
const navColor = customNavColor || '#000000';
const navHoverColor = customNavHoverColor || '#FDFDFD';
const logoHoverColor = customLogoHoverColor || navHoverColor;

---

<header class="sticky top-0 z-[60]" style="background-color: transparent;">
  <div class="container mx-auto px-4 lg:px-8 relative z-[60]">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2 group nav-item-hover">
        <span 
          id="logo-link"
          class="text-primary font-brand font-black text-lg md:text-xl leading-6 tracking-wider inline-block transition-colors header-logo-link"
          style={`min-width: 70px; color: ${navColor};`}
          data-hover-color={logoHoverColor}
        >
          SENRI
        </span>
      </a>

      <!-- Center: Works (desktop only) -->
      <a 
        href="https://josencv.vercel.app" 
        target="_blank" 
        rel="noopener noreferrer" 
        class="hidden md:block text-primary font-black text-lg transition-colors inline-block header-works-link nav-item-hover"
        id="works-link"
        style={`min-width: 85px; color: ${navColor};`}
        data-hover-color={logoHoverColor}
      >
        WORKS
      </a>

      <!-- Right: Contact (desktop only) -->
      <div class="relative hidden md:block nav-item-hover">
        <button 
          id="contact-btn" 
          class="text-gray-900 font-medium text-lg transition-colors cursor-pointer inline-block header-contact-btn"
          style="min-width: 100px;"
          data-hover-color={navHoverColor}
        >
          CONTACT
        </button>
        
        <!-- Tooltip with email link (hidden by default) -->
        <div 
          id="contact-tooltip" 
          class="absolute top-full right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg p-4 opacity-0 pointer-events-none transition-opacity w-72 z-50"
        >
          <a 
            href="mailto:jemmdev@gmail.com" 
            class="block text-center px-4 py-2 transition-colors header-email-link underline decoration-2 text-sm font-medium"
            style={`color: ${navColor}; text-underline-offset: 3px;`}
            data-hover-color={navHoverColor}
          >
            jemmdev@gmail.com
          </a>
        </div>
      </div>

      <!-- Mobile: Hamburger Menu Button -->
      <button 
        id="mobile-menu-btn" 
        class="md:hidden flex flex-col justify-center items-center w-8 h-8 relative z-[70]"
        aria-label="Toggle menu"
      >
        <span id="hamburger-line-1" class="w-6 h-0.5 bg-gray-900 transition-all duration-300 absolute"></span>
        <span id="hamburger-line-2" class="w-6 h-0.5 bg-gray-900 transition-all duration-300 absolute mt-3"></span>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div 
    id="mobile-menu" 
    class="md:hidden fixed inset-0 bg-background z-50 opacity-0 pointer-events-none transition-opacity duration-300"
  >
    <div class="container mx-auto px-4 lg:px-8 pt-20">
      <nav class="flex flex-col">
        <!-- Works Link -->
        <div class="pb-8 border-b" style={`border-color: ${navHoverColor};`}>
          <a 
            href="https://josencv.vercel.app" 
            target="_blank" 
            rel="noopener noreferrer" 
            class="font-black text-3xl hover:opacity-80 transition-opacity inline-flex items-start gap-1 relative"
            style={`color: ${navColor};`}
          >
            VIEW MY WORK
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="absolute -top-0.5 -right-4" style={`stroke: ${navHoverColor};`}>
              <path d="M7 17L17 7"></path>
              <path d="M7 7h10v10"></path>
            </svg>
          </a>
        </div>

        <!-- Contact Section -->
        <div class="py-8 border-b" style={`border-color: ${navHoverColor};`}>
          <div class="space-y-4">
            <div class="text-gray-900 font-medium text-3xl">CONTACT</div>
            <a 
              href="mailto:jemmdev@gmail.com" 
              id="mobile-email-link"
              class="inline-block py-3 text-lg font-medium transition-colors header-email-link-mobile underline decoration-2"
              style={`color: ${navColor}; text-underline-offset: 4px;`}
              data-hover-color={navHoverColor}
            >
              jemmdev@gmail.com
            </a>
          </div>
        </div>

        <!-- Social Links Section -->
        <div class="py-8">
          <div class="space-y-4">
            <div class="text-gray-900 font-medium text-3xl">SOCIALS</div>
            <div class="flex flex-col gap-3">
              <a 
                href="https://github.com/jemmdevs" 
                target="_blank" 
                rel="noopener noreferrer"
                id="mobile-github-link"
                class="text-lg transition-colors inline-flex items-start gap-1.5 header-social-link"
                style={`color: ${navColor};`}
                data-hover-color={navHoverColor}
              >
                GitHub
                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="relative -top-0.5">
                  <path d="M7 17L17 7"></path>
                  <path d="M7 7h10v10"></path>
                </svg>
              </a>
              <a 
                href="https://www.linkedin.com/in/jose-enrique-mateo-munoz-102b28374/" 
                target="_blank" 
                rel="noopener noreferrer"
                id="mobile-linkedin-link"
                class="text-lg transition-colors inline-flex items-start gap-1.5 header-social-link"
                style={`color: ${navColor};`}
                data-hover-color={navHoverColor}
              >
                LinkedIn
                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="relative -top-0.5">
                  <path d="M7 17L17 7"></path>
                  <path d="M7 7h10v10"></path>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </nav>
    </div>
  </div>
</header>

<script>
  // Aplicar colores hover personalizados
  function setupCustomHoverColors() {
    // Logo SENRI - sin cambio de color en hover
    const logoLink = document.querySelector('.header-logo-link') as HTMLElement | null;
    // Logo mantiene su color negro

    // WORKS - sin cambio de color en hover
    const worksLink = document.querySelector('.header-works-link') as HTMLElement | null;
    // Works mantiene su color negro

    // Contact button - sin cambio de color en hover
    const contactBtn = document.querySelector('.header-contact-btn') as HTMLElement | null;
    // Contact mantiene su color negro

    // Email links hover (desktop & mobile)
    const emailLinks = document.querySelectorAll('.header-email-link, .header-email-link-mobile');
    emailLinks.forEach(link => {
      const htmlLink = link as HTMLElement;
      const hoverColor = htmlLink.getAttribute('data-hover-color');
      const originalColor = htmlLink.style.color;
      if (hoverColor) {
        htmlLink.addEventListener('mouseenter', () => {
          htmlLink.style.color = hoverColor;
        });
        htmlLink.addEventListener('mouseleave', () => {
          htmlLink.style.color = originalColor;
        });
      }
    });

    // Mobile links hover
    const mobileLinks = document.querySelectorAll('.header-link-mobile');
    mobileLinks.forEach(link => {
      const htmlLink = link as HTMLElement;
      const hoverColor = htmlLink.getAttribute('data-hover-color');
      if (hoverColor) {
        htmlLink.addEventListener('mouseenter', () => {
          htmlLink.style.color = hoverColor;
        });
        htmlLink.addEventListener('mouseleave', () => {
          htmlLink.style.color = '';
        });
      }
    });

    // Social links hover (GitHub and LinkedIn in mobile menu)
    const socialLinks = document.querySelectorAll('.header-social-link');
    socialLinks.forEach(link => {
      const htmlLink = link as HTMLElement;
      const hoverColor = htmlLink.getAttribute('data-hover-color');
      const originalColor = htmlLink.style.color;
      if (hoverColor) {
        htmlLink.addEventListener('mouseenter', () => {
          htmlLink.style.color = hoverColor;
        });
        htmlLink.addEventListener('mouseleave', () => {
          htmlLink.style.color = originalColor;
        });
      }
    });
  }

  setupCustomHoverColors();

  // Mobile Menu
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerLine1 = document.getElementById('hamburger-line-1');
  const hamburgerLine2 = document.getElementById('hamburger-line-2');
  let isMobileMenuOpen = false;

  mobileMenuBtn?.addEventListener('click', () => {
    isMobileMenuOpen = !isMobileMenuOpen;
    
    if (isMobileMenuOpen) {
      // Open menu
      mobileMenu?.classList.remove('opacity-0', 'pointer-events-none');
      mobileMenu?.classList.add('opacity-100', 'pointer-events-auto');
      
      // Block scroll
      document.body.style.overflow = 'hidden';
      
      // Transform to X (乂)
      hamburgerLine1?.classList.add('rotate-45', 'translate-y-1');
      hamburgerLine2?.classList.add('-rotate-45', '-translate-y-1');
    } else {
      // Close menu
      mobileMenu?.classList.add('opacity-0', 'pointer-events-none');
      mobileMenu?.classList.remove('opacity-100', 'pointer-events-auto');
      
      // Enable scroll
      document.body.style.overflow = '';
      
      // Transform back to hamburger
      hamburgerLine1?.classList.remove('rotate-45', 'translate-y-1');
      hamburgerLine2?.classList.remove('-rotate-45', '-translate-y-1');
    }
  });


  // Desktop Contact Tooltip
  const contactBtn = document.getElementById('contact-btn');
  const contactTooltip = document.getElementById('contact-tooltip');
  
  let isTooltipVisible = false;
  let hideTimeout: ReturnType<typeof setTimeout> | null = null;
  
  // Show tooltip on hover (desktop) or click (mobile)
  const showTooltip = () => {
    if (hideTimeout) {
      clearTimeout(hideTimeout);
      hideTimeout = null;
    }
    contactTooltip?.classList.remove('opacity-0', 'pointer-events-none');
    contactTooltip?.classList.add('opacity-100', 'pointer-events-auto');
    isTooltipVisible = true;
  };
  
  // Hide tooltip with delay
  const hideTooltip = () => {
    hideTimeout = setTimeout(() => {
      contactTooltip?.classList.add('opacity-0', 'pointer-events-none');
      contactTooltip?.classList.remove('opacity-100', 'pointer-events-auto');
      isTooltipVisible = false;
    }, 200);
  };
  
  // Desktop: hover events
  contactBtn?.addEventListener('mouseenter', () => {
    if (window.innerWidth >= 768) {
      showTooltip();
    }
  });
  
  contactBtn?.addEventListener('mouseleave', () => {
    if (window.innerWidth >= 768) {
      hideTooltip();
    }
  });
  
  // Keep tooltip visible when hovering over it
  contactTooltip?.addEventListener('mouseenter', () => {
    if (window.innerWidth >= 768 && hideTimeout) {
      clearTimeout(hideTimeout);
      hideTimeout = null;
    }
  });
  
  contactTooltip?.addEventListener('mouseleave', () => {
    if (window.innerWidth >= 768) {
      hideTooltip();
    }
  });
  
  // Mobile: click to toggle
  contactBtn?.addEventListener('click', (e) => {
    if (window.innerWidth < 768) {
      e.stopPropagation();
      if (isTooltipVisible) {
        contactTooltip?.classList.add('opacity-0', 'pointer-events-none');
        contactTooltip?.classList.remove('opacity-100', 'pointer-events-auto');
        isTooltipVisible = false;
      } else {
        showTooltip();
      }
    }
  });
  
  // Close tooltip when clicking outside (mobile)
  document.addEventListener('click', (e) => {
    if (window.innerWidth < 768 && isTooltipVisible && e.target) {
      const target = e.target as HTMLElement;
      if (!target.closest('#contact-btn') && !target.closest('#contact-tooltip')) {
        contactTooltip?.classList.add('opacity-0', 'pointer-events-none');
        contactTooltip?.classList.remove('opacity-100', 'pointer-events-auto');
        isTooltipVisible = false;
      }
    }
  });
  
</script>

<style>
  /* Efecto glassmorphism mejorado en hover para elementos de navbar */
  .nav-item-hover {
    position: relative;
    padding: 0.35rem 0.75rem;
    border-radius: 1.5rem;
    transition: all 0.3s ease;
  }

  .nav-item-hover::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 1.5rem;
    background: rgba(255, 255, 255, 0.4);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.5);
    box-shadow: 
      0 4px 6px rgba(0, 0, 0, 0.05),
      0 2px 4px rgba(0, 0, 0, 0.03),
      inset 0 1px 0 rgba(255, 255, 255, 0.7);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
  }

  .nav-item-hover:hover::before {
    opacity: 1;
  }
</style>